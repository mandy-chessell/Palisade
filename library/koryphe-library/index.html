
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Koryphe Â· Palisade Doc</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../doc/developer-guide/developer_guide.html">
            
                <a href="../../doc/developer-guide/developer_guide.html">
            
                    
                    Developer Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../doc/developer-guide/initial_requirements.html">
            
                <a href="../../doc/developer-guide/initial_requirements.html">
            
                    
                    Initial Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../doc/developer-guide/design_principles.html">
            
                <a href="../../doc/developer-guide/design_principles.html">
            
                    
                    Design Principles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../doc/developer-guide/high_level_architecture.html">
            
                <a href="../../doc/developer-guide/high_level_architecture.html">
            
                    
                    High level architectural diagram
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../doc/developer-guide/map_reduce_architecture.html">
            
                <a href="../../doc/developer-guide/map_reduce_architecture.html">
            
                    
                    High level architecture using a map reduce client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../doc/developer-guide/component_descriptions.html">
            
                <a href="../../doc/developer-guide/component_descriptions.html">
            
                    
                    Description of each component
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../doc/developer-guide/read_process.html">
            
                <a href="../../doc/developer-guide/read_process.html">
            
                    
                    Standard flow for a read request through the Palisade system
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../../doc/developer-guide/deployment_ideas.html">
            
                <a href="../../doc/developer-guide/deployment_ideas.html">
            
                    
                    How might the system be deployed?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../../doc/developer-guide/security_considerations.html">
            
                <a href="../../doc/developer-guide/security_considerations.html">
            
                    
                    Security considerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../../doc/developer-guide/roadmap.html">
            
                <a href="../../doc/developer-guide/roadmap.html">
            
                    
                    Roadmap for Palisade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../doc/use_cases.html">
            
                <a href="../../doc/use_cases.html">
            
                    
                    Use Cases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../service/">
            
                <a href="../../service/">
            
                    
                    Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../service/audit-service/">
            
                <a href="../../service/audit-service/">
            
                    
                    Audit Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../service/cache-service/">
            
                <a href="../../service/cache-service/">
            
                    
                    Cache Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../service/data-service/">
            
                <a href="../../service/data-service/">
            
                    
                    Data Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../service/palisade-service/">
            
                <a href="../../service/palisade-service/">
            
                    
                    Palisade Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../service/policy-service/">
            
                <a href="../../service/policy-service/">
            
                    
                    Policy Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../../service/resource-service/">
            
                <a href="../../service/resource-service/">
            
                    
                    Resource Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../../service/user-service/">
            
                <a href="../../service/user-service/">
            
                    
                    User Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../example/">
            
                <a href="../../example/">
            
                    
                    Examples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../example/single-jvm-example/">
            
                <a href="../../example/single-jvm-example/">
            
                    
                    Single JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../example/multi-jvm-example/">
            
                <a href="../../example/multi-jvm-example/">
            
                    
                    Multi JVM/Docker deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../example/mapreduce-example/">
            
                <a href="../../example/mapreduce-example/">
            
                    
                    Map Reduce
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Libraries
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.6.1" data-path="./">
            
                <a href="./">
            
                    
                    Koryphe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Other
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../doc/other/ways_of_working.html">
            
                <a href="../../doc/other/ways_of_working.html">
            
                    
                    Ways of Working
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <a target="_blank" href="ref://doc/javadoc">
            
                    
                    Javadoc
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Koryphe</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <!---
Copyright 2018 Crown Copyright

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--->
<h1 id="koryphe-library">Koryphe Library</h1>
<p>This library adds Koryphe Functions/Predicates to Palisade.</p>
<p><img src="../../doc/img/koryphe_logo_text.png" width="200"></p>
<p><a href="https://github.com/gchq/koryphe" target="_blank">Koryphe</a> provides several lightweight 
reusable functions and predicates that can be chained together and applied
to generic tuple objects. Using this library allows you to define your
Palisade Policy rules in standard reusable way without having to
create lots of similar java classes. It also provides a mechanism
for extracting fields from objects/tuples and passing them directly to
functions/predicates.</p>
<p>This allows commonly used Koryphe functions, such as <code>IsMoreThan</code>, to be applied against a record&apos;s field, such as timestamp, without having to implement and create new java functions in the code.</p>
<h3 id="without-koryphe-rules">Without Koryphe Rules</h3>
<p>Each rule must be implemented in code like with the below example from <a href="https://github.com/gchq/Palisade/blob/master/example/example-model/src/main/java/uk/gov/gchq/palisade/example/rule/IsExampleObjRecent.java" title="IsExampleObjRecent" target="_blank">IsExampleObjRecent</a>. </p>
<pre class="language-"><code class="lang-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IsExampleObjRecent</span> <span class="token keyword">implements</span> <span class="token class-name">Rule</span><span class="token generics function"><span class="token punctuation">&lt;</span>ExampleObj<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> threshold<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">IsExampleObjRecent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">IsExampleObjRecent</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">long</span> threshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> ExampleObj <span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">final</span> ExampleObj record<span class="token punctuation">,</span> <span class="token keyword">final</span> User user<span class="token punctuation">,</span> <span class="token keyword">final</span> Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>null <span class="token operator">==</span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> isRecent <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> threshold<span class="token punctuation">;</span>
        <span class="token keyword">return</span> isRecent <span class="token operator">?</span> record <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the this example the threshold value is passed in at the <code>constructor</code> and the <code>&gt;</code> logic is implemented within the <code>apply()</code> method, but this method is also responsible for getting the correct field from the record <code>ExampleObj.getTimestamp()</code>.
To implement the same logic against either a different field or object, would require a new implementation of a similar class with duplicated logic.</p>
<h3 id="using-koryphe-rules">Using Koryphe Rules</h3>
<p>The logic of a Koryphe predicate rule is reusable, because only threshold value and the field selection/projections changes.</p>
<h4 id="predicates">Predicates</h4>
<p>The below example from <a href="https://github.com/gchq/Palisade/blob/master/example/single-jvm-example/single-jvm-example-client/src/main/java/uk/gov/gchq/palisade/example/client/ExampleSimpleClient.java" title="ExampleSimpleClient" target="_blank">ExampleSimpleClient</a> shows a rule named &quot;ageOff&quot;. This rule applies the <code>IsMoreThan</code> function with a threshold of 12, against the &quot;timestamp&quot; field within a Record object. To apply the same rule against another field or object only the selection argument needs to be changed.</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">new</span> <span class="token class-name">TupleRule</span><span class="token generics function"><span class="token punctuation">&lt;</span>ExampleObj<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">selection</span><span class="token punctuation">(</span><span class="token string">&quot;Record.timestamp&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">predicate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IsMoreThan</span><span class="token punctuation">(</span><span class="token number">12</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="nested-selection">Nested Selection</h5>
<p>The Koryphe rules are applied against a tuple with named fields (or by default wrapped in a inefficient Reflective Tuple). This allows selecting nested fields within a record or object, i.e. <code>select(&quot;library.room.shelf.book.paragraph.sentence.word&quot;)</code>, without having to implement the logic within Java code, provided the fields or getMethods for the structures are public.</p>
<h4 id="functions">Functions</h4>
<p>The below example is how Koryphe rules can be used to manipulate a record. In this case we are setting &apos;new value&apos; on the record. </p>
<pre class="language-"><code class="lang-java"><span class="token keyword">new</span> <span class="token class-name">TupleRule</span><span class="token generics function"><span class="token punctuation">&lt;</span>ExampleObj<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">selection</span><span class="token punctuation">(</span><span class="token string">&quot;Record.value1&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SetValue</span><span class="token punctuation">(</span><span class="token string">&quot;new value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span><span class="token string">&quot;Record.value1&quot;</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>A <strong>selection</strong> is made &quot;Record.value1&quot; (in this example the selection isn&apos;t used)</li>
<li>A <strong>predicate</strong> is applied, in this example the there is no logic other that a value is created &quot;new value&quot;</li>
<li>Output is written to the <strong>projection</strong>, in this example the projection is the same as the original selection &quot;Record.value1&quot;</li>
</ul>
<h4 id="if-logic">If Logic</h4>
<p>The below example from <a href="https://github.com/gchq/Palisade/blob/master/example/single-jvm-example/single-jvm-example-client/src/main/java/uk/gov/gchq/palisade/example/client/ExampleSimpleClient.java" title="ExampleSimpleClient" target="_blank">ExampleSimpleClient</a> shows how decision logic can be applied using Koryphe rules. </p>
<pre class="language-"><code class="lang-java"><span class="token keyword">new</span> <span class="token class-name">TupleRule</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ExampleObj<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">selection</span><span class="token punctuation">(</span><span class="token string">&quot;User.roles&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Record.property&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">If</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">predicate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Not</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CollectionContains</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SetValue</span><span class="token punctuation">(</span><span class="token string">&quot;redacted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>The selection has two values <code>selection(&quot;User.roles&quot;, &quot;Record.property&quot;)</code> these can be referenced within the <code>If</code> function by their respective keys (0,1).
In the example the predicate is applied against the &apos;0&apos; selection &quot;User.roles&quot;, when evaluated as true the function within the &quot;.then&quot; method is executed otherwise the function in the &quot;.otherwise&quot; function (not shown in the example.) This examples shows the value &quot;redacted&quot; being written to the selection &apos;1&apos;/&quot;Record.property&quot;.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Koryphe","level":"1.6.1","depth":2,"next":{"title":"Other","level":"1.7","depth":1,"ref":"","articles":[{"title":"Ways of Working","level":"1.7.1","depth":2,"path":"doc/other/ways_of_working.md","ref":"doc/other/ways_of_working.md","articles":[]}]},"previous":{"title":"Libraries","level":"1.6","depth":1,"ref":"","articles":[{"title":"Koryphe","level":"1.6.1","depth":2,"path":"library/koryphe-library/README.md","ref":"library/koryphe-library/README.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-interactive","codetabs","prism","-highlight","github","anchorjs","otherlink"],"root":"./","styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"github":{"url":"https://github.com/gchq/palisade"},"search":{"maxIndexSize":5000000},"otherlink":{},"codetabs":{},"lunr":{"maxIndexSize":5000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"expandable-chapters-interactive":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"contents.md"},"variables":{},"title":"Palisade Doc","gitbook":"3.x.x"},"file":{"path":"library/koryphe-library/README.md","mtime":"2018-11-16T11:05:04.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-16T12:52:41.996Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-interactive/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-otherlink/js/otherlink.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

